{
  "default": {
    "environment":{
      "attempt_count": "1"
    }
  },
  "client": "${client_ip}", 
  "server": "${server_ip}:88",
  "sequence": [
    ["for.session", [0, "${attempt_count}"], "i", [
        ["sys.print", "krb5: ${client_ip} -> ${server_ip}:88"],

        ["env.local.default", {
          "user_name": "${rand.lower_alpha(8)}"
        }],
        
        ["env.local.set-payload", {
          "as_req": ["hex", "asn1.raw",
            {
              "APPLICATION [10]:+": [
                {
                  "SEQUENCE:+": [
                    {
                      "CONTEXT [1]:+": [
                        {
                          "INTEGER": 5
                        }
                      ]
                    },
                    {
                      "CONTEXT [2]:+": [
                        {
                          "INTEGER": 10
                        }
                      ]
                    },
                    {
                      "CONTEXT [3]:+": [
                        {
                          "SEQUENCE:+": [
                            {
                              "SEQUENCE:+": [
                                {
                                  "CONTEXT [1]:+": [
                                    {
                                      "INTEGER": 128
                                    }
                                  ]
                                },
                                {
                                  "CONTEXT [2]:+": [
                                    {
                                      "OCTET STRING": [
                                        "hex.raw", "3005a0030101ff"
                                      ]
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "CONTEXT [4]:+": [
                        {
                          "SEQUENCE:+": [
                            {
                              "CONTEXT [0]:+": [
                                {
                                  "BIT STRING": [
                                    "hex.raw", "0040810010"
                                  ]
                                }
                              ]
                            },
                            {
                              "CONTEXT [1]:+": [
                                {
                                  "SEQUENCE:+": [
                                    {
                                      "CONTEXT [0]:+": [
                                        {
                                          "INTEGER": 1
                                        }
                                      ]
                                    },
                                    {
                                      "CONTEXT [1]:+": [
                                        {
                                          "SEQUENCE:+": [
                                            {
                                              "GENERAL STRING": [
                                                "text.raw", "${user_name}"
                                              ]
                                            }
                                          ]
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ]
                            },
                            {
                              "CONTEXT [2]:+": [
                                {
                                  "GENERAL STRING": [
                                    "text.raw", "corp.cortex.lan"
                                  ]
                                }
                              ]
                            },
                            {
                              "CONTEXT [3]:+": [
                                {
                                  "SEQUENCE:+": [
                                    {
                                      "CONTEXT [0]:+": [
                                        {
                                          "INTEGER": 2
                                        }
                                      ]
                                    },
                                    {
                                      "CONTEXT [1]:+": [
                                        {
                                          "SEQUENCE:+": [
                                            {
                                              "GENERAL STRING": [
                                                "text.raw", "krbtgt"
                                              ]
                                            },
                                            {
                                              "GENERAL STRING": [
                                                "text.raw", "corp.cortex.lan"
                                              ]
                                            }
                                          ]
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ]
                            },
                            {
                              "CONTEXT [5]:+": [
                                {
                                  "GENERALIZED TIME": [
                                    "text.raw", "${time.utcnow()=(val + (60 * 60 * 24 * 365 * 10)).timestr(YYYYMMDDHHmmssZ)}"
                                  ]
                                }
                              ]
                            },
                            {
                              "CONTEXT [7]:+": [
                                {
                                  "INTEGER": 1286395133
                                }
                              ]
                            },
                            {
                              "CONTEXT [8]:+": [
                                {
                                  "SEQUENCE:+": [
                                    {
                                      "INTEGER": 18
                                    },
                                    {
                                      "INTEGER": 17
                                    },
                                    {
                                      "INTEGER": 23
                                    },
                                    {
                                      "INTEGER": 24
                                    },
                                    {
                                      "INTEGER": -135
                                    },
                                    {
                                      "INTEGER": 3
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }],
        
        ["", "## AS-REQ"],
        ["tcp.send", "multi", [
            ["hex.raw", "${as_req=(val.length() / 2).hex_be(4)}"],
            ["hex.raw", "${as_req}"]
          ]
        ],
        ["", "## KRB-ERR : KRB5KDC_ERR_PREAUTH_FAILED"],
        ["tcp.recv", "multi", [
            ["hex.raw", [
                "00 00 00 65",
                "7e 63 30 61 a0 03 02 01  05 a1 03 02 01 1e a4 11",
                "18 0f"
              ]
            ],
            ["text.raw", "${time.utcnow()=val.timestr(YYYYMMDDHHmmssZ)}"],
            ["hex.raw", [
                "a5 04 02 02 3a e1 a6 03  02 01 18 a9 11 1b 0f 63",
                "6f 72 70 2e 63 6f 72 74  65 78 2e 6c 61 6e aa 24",
                "30 22 a0 03 02 01 02 a1  1b 30 19 1b 06 6b 72 62",
                "74 67 74 1b 0f 63 6f 72  70 2e 63 6f 72 74 65 78",
                "2e 6c 61 6e"
              ]
            ]
          ]
        ],

        ["sys.time.sleep", 500]
      ]
    ]
  ]
}
